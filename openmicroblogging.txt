===============================
OpenMicroBlogging specification
===============================

:Author: Evan Prodromou (Control Yourself, Inc.)
:Contact: evan@controlezvous.ca
:Revision: 0.1.1
:Date: 2008-07-07
:Copyright: To the extent possible under law, Control Yourself, Inc
	    has waived all copyright, moral rights, database rights,
	    and any other rights that might be asserted over
	    The OpenMicroBlogging specification.

Purpose
=======

To allow users of one microblogging service to publish notices to
users of another service, with the other users' permission.

Enabling technologies
=====================

Depends on OAuth 1.0, OAuth Discovery 1.0, YADIS 1.0.

We piggy-back additional information onto these protocols to pass
microblogging information back and forth.

Terminology
===========

microblogging service
    undefined.
user
    undefined.
subscribe
    to allow a publishing service to send notices to the user's local
    service on a remote user's behalf.
subscriber
    the person subscribing.
publisher
    the user sending notices.
publishing service
    the publisher's microblogging service.
subscriber service
    the subscriber's microblogging service.
profile URL
    "home" URL for the subscriber, typically their profile page on a
    microblogging site.
nickname
    An alphanumeric short name for a person, 1-64 characters.
identifier URI
    A globally unique and unchanging identifying URI for a user.
    Need not be an URL. [*]_
notice URI
    A unique and unchanging identifier for a notice. Need not be an
    URL. [*]_

.. [*] May be the profile URL, if it's defined not to change or be
   re-used. The profile URL of some services includes the nickname,
   and some let the user change his/her nickname. This user's profile
   URL may change from 'http://example.net/~john' to
   'http://example.net/~johnsmith' A tag URI, like
   'tag:example.net,2008:user:1' may be more appropriate here.
.. [*] IWBNI the notice URI is used everywhere the notice is
   published; for example, in any RSS feeds.

Initiation
==========

The user submits their profile URL [*]_ to the publishing service somehow --
for example, with an HTML form on the publishing service's Web site.

.. [*] For OAuth Discovery, this is the "protected resource". It may
   be more correct that the protected resource is the postNotice URL
   (see below), but the subscriber will be more familiar with their own
   profile URL. So there will have to be discovery of the postNotice
   URL anyways, and it might as well all be done in one step.

Discovery
=========

The publishing service recovers a YADIS document from the profile URL, as
described in OAuth Discovery.

The request token service must have a LocalID associated with it,
containing the identifier URI for the subscriber.

The following two extra services must be included in the YADIS
document, with accompanying URIs.

http://openmicroblogging.org/protocol/0.1/postNotice
    Post Notice URL, as defined below.

http://openmicroblogging.org/protocol/0.1/updateProfile
    Update Profile URL, as defined below.

If any of the URIs is unavailable, the publishing service MUST stop
processing.

Authorization
=============

The publishing service must go through the OAuth 1.0 dance to get
authorization to post notices and update profiles.

In all OAuth, the consumer key should be the root URL for the
microblogging service, if available. The secret should be the blank
string (''), unless the remote server and subscriber service have negotiated
another key. Such negotiation is out-of-scope for this document, and we
assume an "open" network of microblogging services. But if you want to
have that kind of network, do it with this key.

The publishing service MUST do OAuth for every new subscriber, regardless of
whether they've already received authorization for posting to the
given postNotice URL. See `Posting a Notice`_ below.

Request token
-------------

The publishing service uses the defined requestToken URL to get a request
token.

In the request token HTTP request, the publishing service MUST send the
following additional parameter(s):

omb_version
    'http://openmicroblogging.org/protocol/0.1'
omb_subscriber
    The identifier URI for the subscriber.

In the results for the request token request, the subscriber service MUST
send the following additional parameters:

omb_version
    'http://openmicroblogging.org/protocol/0.1'

User authorization
------------------

In requesting user authorization, the publishing service must send the
following parameters:

omb_version
    'http://openmicroblogging.org/protocol/0.1'.
omb_subscriber
    The identifier URI for the subscriber.
omb_publisher
    The identifier URI for the publisher.
omb_publisher_profile
    The profile URL of the publisher.
omb_publisher_nickname
    The nickname of the publisher.
omb_publisher_license
    The default license URL for the publisher's stream. Typically the
    URL of a Creative Commons license, with the Attribution license
    being heavily encouraged. CC0 quitclaim also pretty good. The
    subscriber service MAY reject publishers if their licenses are
    incompatible with the service.

The publishing service should send as many of the following parameters as
possible. This will help the user decide if they really want to allow
the subscription to happen, and allow the subscriber service to store a copy
of the publisher's profile.

omb_publisher_fullname
    The full name of the publisher. Up to 255 chars.
omb_publisher_homepage
    The home page of the publisher (may be distinct from the profile
    URL).
omb_publisher_bio
    A brief biography of the publisher; less than 140 chars.
omb_publisher_location
    Physical location of the publisher; less that 255 chars. No fixed
    structure, but "Locality, Region, Country" or "Locality, Country"
    or "Locality, Region" recommended.
omb_publisher_avatar
    URL of a 96px by 96px image in PNG, GIF or JPEG format representing
    the publisher.

The subscriber service, in a successful response, must return the
following additional parameters:

omb_version
    'http://openmicroblogging.org/protocol/0.1'.
omb_subscriber_nickname
    A nickname for the subscriber.
omb_subscriber_profile
    The profile URL for the subscriber, possibly cleaned up or
    canonicalized.

It should return as many of the following as possible:

omb_subscriber_fullname
    The full name of the subscriber. Up to 255 chars.
omb_subscriber_homepage
    The home page of the subscriber (may be distinct from the profile
    URL).
omb_subscriber_bio
    A brief biography of the subscriber; less than 140 chars.
omb_subscriber_location
    Physical location of the subscriber; less that 255 chars. No fixed
    structure, but "Locality, Region, Country" or "Locality, Country"
    or "Locality, Region" recommended.
omb_subscriber_avatar
    URL of a 96px by 96px image in PNG, GIF or JPEG format representing
    the subscriber.

This will allow the publishing service to display information about the
subscriber in the publisher's "subscribers" or "subscribers" list.

Access token
------------

The access token step of the OAuth protocol requires no additional
parameters.

Posting a Notice
================

To post a notice to the subscriber service, the publishing service sends an HTTP
POST message to the postNotice URL discovered above. The message must
use OAuth authorization. The message must also include the following
parameters:

omb_version
    'http://openmicroblogging.org/protocol/0.1'.
omb_publisher
    The identifier URI for the publisher.
omb_notice
    The notice URI.
omb_notice_content
    The content of the notice. No maximum, but 140 chars is recommended.

The message may include the following parameters:

omb_notice_url
    The URL of the notice, if the notice is retrievable.
omb_notice_license
    The URL of the license for the notice, if different from the
    publisher's default license.
omb_seealso
    URL of additional content for the notice; for example, an image,
    video, or audio file.
omb_seealso_disposition
    One of 'link' or 'inline', to recommend how the extra data should
    be shown. Default 'link'.
omb_seealso_mediatype
    Internet Media Type of the see-also data. Advisory, probably
    shouldn't be trusted.
omb_seealso_license
    License for the attached data. May be distinct from the notice's
    license (if they're passing along someone else's content).

The subscriber service should include the following parameters in its
response:

omb_version
    'http://openmicroblogging.org/protocol/0.1'.

The subscriber service makes no guarantees about the delivery of the notice
to anyone.

The publishing service SHOULD NOT send a message with the same notice URL
to the same postNotice URL more than once. [*]_ If the request returns
a 403 Unauthorized message, the publishing service SHOULD NOT post
messages to the same URL again with the same publisher, until another
subscriber has gone through the OAuth dance. [*]_

.. [*] A half-assed optimization. A subscriber service may have a lot of
   subscribers subscribed to the same publisher. It would be pointless to
   have the publishing service post the same notice 100 times to the same
   service. However, if the subscriber service wants fine-grained control,
   it can have a different postNotice URL for each subscriber.
.. [*] If there's one postNotice URL per subscriber, the 403 message
   means the subscriber has told the subscriber service not to allow posting
   any more ("unsubscribed"). If there's one postNotice URL per local
   service, it means that the count of subscribers has dropped to 0.

Updating a profile
==================

If the publisher's profile information changes, the publishing service MAY
send an HTTP POST message to to the updateProfile URL to tell the
subscriber service about the change.

The message must use OAuth authorization. The message must also
include the following parameters:

omb_version
    'http://openmicroblogging.org/protocol/0.1'.
omb_publisher
    The identifier URI for the publisher.

The message may include any of the following parameters:

omb_publisher_profile
    The profile URL of the publisher.
omb_publisher_nickname
    The nickname of the publisher.
omb_publisher_license
    The default license URL for the publisher's stream. A change in the
    default license only applies to future notices; notices previous
    to the update SHOULD be treated as under the old license.
omb_publisher_fullname
    The full name of the publisher. Up to 255 chars.
omb_publisher_homepage
    The home page of the publisher.
omb_publisher_bio
    A brief biography of the publisher; less than 140 chars.
omb_publisher_location
    Physical location of the publisher; less that 255 chars.
omb_publisher_avatar
    URL of a 96px by 96px image in PNG, GIF or JPEG format representing
    the publisher.

Missing parameters should not be construed to mean that the profile
field has been blanked. The publishing service MUST set the parameter to
an empty string to show that the field is blank.

References
==========

* OAuth: http://oauth.net/
* OAuth Discovery: http://oauth.net/discovery/1.0
* XRDS Simple: http://xrds-simple.net/core/1.0/